---
title: "Анализ объёма репрезентативной выборки для проекта смс-рассылки"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
# install.packages("gamlss")
# install.packages("foreach")
library(foreach)
```



## Результаты смс-опроса

В ходе тестирования проекта были получены следующие результаты
```{r}
x_real <- c(rep(1, 11), rep(2, 3), rep(3, 2), rep(4, 2), rep(5, 44))

as.tibble(x_real) %>%
ggplot(aes(x_real)) + geom_density()

sd(x_real)
mean(x_real)
summary(x_real)
```

Так как нет возможности получить данные о всех оценках, то распределение генеральной совокупности генерируется методом экстраполяции полученных данных.
Cреднемесячный объём квартирных заявок в БЕ брался из исследования Ю. Захаровой.

![alt text](1.PNG)


```{r}
gs <- as.tibble(read_csv("Генеральная совокупность.csv"))

sd(gs$x)
mean(gs$x)
min(gs$x)
max(gs$x)

summary(gs$x)

ggplot(gs, aes(x)) + geom_density()


mean(sample(gs$x, 1000, replace = TRUE))

```

Тогда какое распределение оценок будет в рамках этой генеральной совокупности?

Вероятно можно попробовать экстраполировать значения полученных данных от одной БЕ (например та, в которой было получено больше всего ответов) на все БЕ.

На основе полученных данных сгенерировал Генеральную совокупность с похожими параметрами.

### Распределение для 10 экземпляров из генеральной совокупности. 10 смс-ок

```{r}
sigma_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (sd(sample(gs$x, 10, replace = TRUE)))
mean_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (mean(sample(gs$x, 10, replace = TRUE)))

sd(sigma_gs)
mean(sigma_gs)

as.tibble(sigma_gs) %>%
  ggplot(aes(sigma_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение стандартной ошибки для 10 наблюдений")

qqnorm(sigma_gs, pch = 1)
qqline(sigma_gs, col = "steelblue", lwd = 2)

as.tibble(mean_gs) %>%
  ggplot(aes(mean_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение среднего для 10 наблюдений")

qqnorm(mean_gs, pch = 1)
qqline(mean_gs, col = "steelblue", lwd = 2)

t.test(mean_gs)
```



### Распределение для 100 экземпляров из генеральной совокупности

```{r}
sigma_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (sd(sample(gs$x, 32000, replace = TRUE)))
t.test(sigma_gs)
mean_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (mean(sample(gs$x, 100, replace = TRUE)))

sd(sigma_gs)
mean(sigma_gs)

as.tibble(sigma_gs) %>%
  ggplot(aes(sigma_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение стандартной ошибки для 100 наблюдений")

qqnorm(sigma_gs, pch = 1)
qqline(sigma_gs, col = "steelblue", lwd = 2)

as.tibble(mean_gs) %>%
  ggplot(aes(mean_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение среднего для 100 наблюдений")

qqnorm(mean_gs, pch = 1)
qqline(mean_gs, col = "steelblue", lwd = 2)

t.test(mean_gs)
t.test(sigma_gs)
```


### Распределение для 1000 экземпляров из генеральной совокупности

```{r}
sigma_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (sd(sample(gs$x, 1000, replace = TRUE)))
mean_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (mean(sample(gs$x, 1000, replace = TRUE)))

sd(sigma_gs)
mean(sigma_gs)

as.tibble(sigma_gs) %>%
  ggplot(aes(sigma_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение стандартной ошибки для 1000 наблюдений")

qqnorm(sigma_gs, pch = 1)
qqline(sigma_gs, col = "steelblue", lwd = 2)

as.tibble(mean_gs) %>%
  ggplot(aes(mean_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение среднего для 1000 наблюдений")

qqnorm(mean_gs, pch = 1)
qqline(mean_gs, col = "steelblue", lwd = 2)

t.test(mean_gs)
```

### Распределение для 10000 экземпляров из генеральной совокупности

```{r}
sigma_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (sd(sample(gs$x, 10000, replace = TRUE)))
mean_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (mean(sample(gs$x, 10000, replace = TRUE)))

sd(sigma_gs)
mean(sigma_gs)

as.tibble(sigma_gs) %>%
  ggplot(aes(sigma_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение стандартной ошибки для 10000 наблюдений")

qqnorm(sigma_gs, pch = 1)
qqline(sigma_gs, col = "steelblue", lwd = 2)

as.tibble(mean_gs) %>%
  ggplot(aes(mean_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение среднего для 10000 наблюдений")

qqnorm(mean_gs, pch = 1)
qqline(mean_gs, col = "steelblue", lwd = 2)

t.test(mean_gs)
```

### Распределение для 15000 экземпляров из генеральной совокупности
```{r}
sigma_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (sd(sample(gs$x, 15000, replace = TRUE)))
mean_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (mean(sample(gs$x, 15000, replace = TRUE)))

sd(sigma_gs)
mean(sigma_gs)

as.tibble(sigma_gs) %>%
  ggplot(aes(sigma_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение стандартной ошибки для 15000 наблюдений")

qqnorm(sigma_gs, pch = 1)
qqline(sigma_gs, col = "steelblue", lwd = 2)

as.tibble(mean_gs) %>%
  ggplot(aes(mean_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение среднего для 15000 наблюдений")

qqnorm(mean_gs, pch = 1)
qqline(mean_gs, col = "steelblue", lwd = 2)

t.test(mean_gs)
```

### Распределение для 32000 экземпляров из генеральной совокупности

```{r}
sigma_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (sd(sample(gs$x, 32000, replace = TRUE)))
mean_gs <- foreach(i = 1:1000, .combine = "c") %do%
    (mean(sample(gs$x, 32000, replace = TRUE)))

sd(sigma_gs)
mean(sigma_gs)

as.tibble(sigma_gs) %>%
  ggplot(aes(sigma_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение стандартной ошибки для 32000 наблюдений")

qqnorm(sigma_gs, pch = 1)
qqline(sigma_gs, col = "steelblue", lwd = 2)

as.tibble(mean_gs) %>%
  ggplot(aes(mean_gs)) + 
  geom_histogram() + 
  labs(title = "Распределение среднего для 32000 наблюдений")

qqnorm(mean_gs, pch = 1)
qqline(mean_gs, col = "steelblue", lwd = 2)

t.test(mean_gs)
```